apiVersion: v1
kind: Secret
metadata:
  name: dex-data-values
  namespace: tanzu-system-auth
type: Opaque
stringData:
  values.yaml: |
    #@data/values
    #@overlay/match-child-defaults missing_ok=True
    ---
    infrastructure_provider: "aws"
    dex:
      image:
        repository: projects-stg.registry.vmware.com/tkg
      service:
        type: NodePort
      config:
        connector: oidc
        oidc:
          CLIENT_ID: {{ .Values.clientId }}
          CLIENT_SECRET: {{ .Values.clientSecret }}
          issuer: {{ .Values.idpUrl }}
        #! Deploy dex first with dummy staticClients. Once gangway is installed in workload cluster, update static clients with gangway information
        #@overlay/replace
        staticClients:
        - id: {{ .Values.wlName1 }}
          redirectURIs:
          - 'https://{{ .Values.gangway1 }}/callback'
          name: aws-workload1
          secret: {{ .Values.wlClientSecret1 }}
    #! Deploy dex first and update sample-elb with real name once dex service loadbalancer is created, dnsNames is optional.
    dns:
      aws:
        DEX_SVC_LB_HOSTNAME: {{ .Values.ingressFQDN }}
        dnsNames: []
